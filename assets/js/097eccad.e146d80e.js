"use strict";(self.webpackChunkpush_website=self.webpackChunkpush_website||[]).push([[87476],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=l(n),h=o,f=c["".concat(p,".").concat(h)]||c[h]||d[h]||i;return n?a.createElement(f,r(r({ref:t},u),{},{components:n})):a.createElement(f,r({ref:t},u))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=h;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[c]="string"==typeof e?e:o,r[1]=s;for(var l=2;l<i;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},41255:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return f},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c}});var a=n(87462),o=n(63366),i=(n(67294),n(3905)),r=["components"],s={id:"docs-notifications-tutorial-send-notification-via-subgraph",title:"Send notification via your subgraph",hide_title:!0,slug:"./send-notification-via-subgraph",displayed_sidebar:"pushNotificationSidebar",sidebar_position:5,image:"/assets/docs/previews/docs_notifications_tutorial_send_notification_via_subgraph--send_notification_via_your_subgraph.png"},p="Overview",l={unversionedId:"notifications/tutorials/docs-notifications-tutorial-send-notification-via-subgraph",id:"notifications/tutorials/docs-notifications-tutorial-send-notification-via-subgraph",title:"Send notification via your subgraph",description:"This is an introductory guide to take you through the entire process of how to send notifications from a Subgraph using Push.",source:"@site/docs/notifications/02-tutorials/05-Tutorial-Send-Notifications-Subgraph.mdx",sourceDirName:"notifications/02-tutorials",slug:"/notifications/tutorials/send-notification-via-subgraph",permalink:"/docs/notifications/tutorials/send-notification-via-subgraph",draft:!1,editUrl:"https://github.com/ethereum-push-notification-service/push-website/blob/main/docs/notifications/02-tutorials/05-Tutorial-Send-Notifications-Subgraph.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"docs-notifications-tutorial-send-notification-via-subgraph",title:"Send notification via your subgraph",hide_title:!0,slug:"./send-notification-via-subgraph",displayed_sidebar:"pushNotificationSidebar",sidebar_position:5,image:"/assets/docs/previews/docs_notifications_tutorial_send_notification_via_subgraph--send_notification_via_your_subgraph.png"},sidebar:"pushNotificationSidebar",previous:{title:"Token transfer notification from smart contract",permalink:"/docs/notifications/tutorials/token-transfer-notification-from-smart-contract"},next:{title:"Push SDK Playground",permalink:"/docs/notifications/tutorials/push-sdk-playground"}},u={},c=[{value:"Introduction: The Graph Protocol &amp; Subgraphs",id:"introduction-the-graph-protocol--subgraphs",level:2},{value:"Notifications from Subgraphs \ud83d\udca1",id:"notifications-from-subgraphs-",level:2},{value:"Sending Notifications using Push",id:"sending-notifications-using-push",level:3},{value:"Push X Graph Integration Example",id:"push-x-graph-integration-example",level:2},{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Contract deployment",id:"contract-deployment",level:3},{value:"Subgraph deployment",id:"subgraph-deployment",level:3},{value:"Redploy your subgraph",id:"redploy-your-subgraph",level:3},{value:"Attach subgraph to your channel",id:"attach-subgraph-to-your-channel",level:3},{value:"Testing notification",id:"testing-notification",level:3}],d={toc:c},h="wrapper";function f(e){var t=e.components,s=(0,o.Z)(e,r);return(0,i.kt)(h,(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"overview"},"Overview"),(0,i.kt)("p",null,"This is an introductory guide to take you through the entire process of how to send notifications from a Subgraph using Push."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Subgraph notifications are currenly supported on staging environtment from ",(0,i.kt)("a",{parentName:"p",href:"https://staging.push.org",title:"Link to Push staging dApp"},"Push dApp"))),(0,i.kt)("head",null,(0,i.kt)("title",null,"Send Notification via your Subgraph | Tutorial | Push Notifications | Push Documentation")),(0,i.kt)("h2",{id:"introduction-the-graph-protocol--subgraphs"},"Introduction: The Graph Protocol & Subgraphs"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"The Graph")," is a decentralized protocol for indexing and querying data from blockchains, starting with Ethereum. It makes it possible to query data that is difficult to query directly."),(0,i.kt)("p",null,"A ",(0,i.kt)("strong",{parentName:"p"},"Subgraph")," defines which data ",(0,i.kt)("strong",{parentName:"p"},"The Graph")," will index from a blockchain, and how it will store it. Once deployed, it will form a part of a global graph of blockchain data which you can retrieve using GraphQL."),(0,i.kt)("p",null,"Currently, Push only supports the subgraphs deployed on ",(0,i.kt)("strong",{parentName:"p"},"Hosted Service of The Graph Protocol"),". Providing support to Subgraph Studio would be part of the next iteration."),(0,i.kt)("p",null,"For more information on how to deploy a subgraph on the hosted service for your smart contract or dApp, check out ",(0,i.kt)("a",{parentName:"p",href:"https://thegraph.com/docs/en/deploying/deploying-a-subgraph-to-hosted/",title:"Tutorial on how to deploy your hosted subgraph from The Graph"},"this documentation"),"."),(0,i.kt)("h2",{id:"notifications-from-subgraphs-"},"Notifications from Subgraphs \ud83d\udca1"),(0,i.kt)("p",null,"Subgraphs retrieve and store data from the blockchain for a particular smart contract. This data can be used to analyze a variety of things related to the smart contract."),(0,i.kt)("p",null,"For example, the ",(0,i.kt)("a",{parentName:"p",href:"https://thegraph.com/hosted-service/subgraph/uniswap/uniswap-v2",title:"Subgraph of Uniswap V2 protocol"},"Uniswap Subgraph")," stores data related to the total volume across all trading pairs, volume data per trading pair, and even data for a particular token."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"What if you intelligently fetch the data from a Subgraph and generate useful alerts \ud83e\udd14?"),"\nThis will be extremely helpful for the end-users of your dApp and entities connected to your smart contract making the user experience smoother."),(0,i.kt)("h3",{id:"sending-notifications-using-push"},"Sending Notifications using Push"),(0,i.kt)("p",null,"Push protocol has developed an in-house ",(0,i.kt)("inlineCode",{parentName:"p"},"helper function")," specifically for The Graph Protocol which allows you to read events from the Subgraph and define notifications accordingly. Once defined, they will be stored on the Subgraph in a ",(0,i.kt)("inlineCode",{parentName:"p"},"Long String")," format."),(0,i.kt)("p",null,"Push Nodes can, later on, fetch the notifications defined on a Subgraph and push them accordingly to Subscribers of the Channel."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Notifications via The Graph architecture",src:n(29569).Z,title:"Flow diagram of how notifications are sent",width:"2000",height:"1000"})),(0,i.kt)("h2",{id:"push-x-graph-integration-example"},"Push X Graph Integration Example"),(0,i.kt)("p",null,"Integrate Push Protocol with an ERC-20 contract's subgraph to ",(0,i.kt)("strong",{parentName:"p"},"send out notifications whenever a Transfer happens"),"."),(0,i.kt)("h3",{id:"pre-requisites"},"Pre-requisites"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Have a Push Notification Channel ready - see the docs ",(0,i.kt)("a",{parentName:"p",href:"/docs/notifications/tutorials/create-your-channel/",title:"Tutorial on how to create your channel"},"here")," to create a channel.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Install the ",(0,i.kt)("strong",{parentName:"p"},"graph CLI"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install -g @graphprotocol/graph-cli\n// or \nyarn global add @graphprotocol/graph-cli\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Link your Github to ",(0,i.kt)("a",{parentName:"p",href:"https://thegraph.com/hosted-service",title:"Link to The Graph hosted service"},"The Graph's hosted service"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Add a subgraph named ",(0,i.kt)("strong",{parentName:"p"},"MySubgraphXYZ")," (or a name of your choice) from your ",(0,i.kt)("a",{parentName:"p",href:"https://thegraph.com/hosted-service/dashboard",title:"Add subgraph from your dashboard"},"Hosted Service Dashboard"),"."))),(0,i.kt)("h3",{id:"contract-deployment"},"Contract deployment"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Skip this step if you a have deployed contract already that you want to query")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Copy and Deploy the sample ERC-20 contract using ",(0,i.kt)("a",{parentName:"p",href:"https://remix.ethereum.org/",title:"Remix IDE from Ethereum"},"Remix IDE")," \u2014"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},'pragma solidity ^0.4.24;\n\n//Safe Math Interface\ncontract SafeMath {\n\n  function safeAdd(uint a, uint b) public pure returns (uint c) {\n    c = a + b;\n    require(c >= a);\n  }\n\n  function safeSub(uint a, uint b) public pure returns (uint c) {\n    require(b <= a);\n    c = a - b;\n  }\n\n  function safeMul(uint a, uint b) public pure returns (uint c) {\n    c = a * b;\n    require(a == 0 || c / a == b);\n  }\n\n  function safeDiv(uint a, uint b) public pure returns (uint c) {\n    require(b > 0);\n    c = a / b;\n  }\n}\n\n// ERC Token Standard #20 Interface\ncontract ERC20Interface {\n  function totalSupply() public constant returns (uint);\n  function balanceOf(address tokenOwner) public constant returns (uint balance);\n  function allowance(address tokenOwner, address spender) public constant returns (uint remaining);\n  function transfer(address to, uint tokens) public returns (bool success);\n  function approve(address spender, uint tokens) public returns (bool success);\n  function transferFrom(address from, address to, uint tokens) public returns (bool success);\n\n  event Transfer(address indexed from, address indexed to, uint tokens);\n  event Approval(address indexed tokenOwner, address indexed spender, uint tokens);\n}\n\n// Contract function to receive approval and execute function in one call\ncontract ApproveAndCallFallBack {\n  function receiveApproval(address from, uint256 tokens, address token, bytes data) public;\n}\n\n//Actual token contract\ncontract PushToken is ERC20Interface, SafeMath {\n  string public symbol;\n  string public  name;\n  uint8 public decimals;\n  uint public _totalSupply;\n\n  mapping(address => uint) balances;\n  mapping(address => mapping(address => uint)) allowed;\n\n  constructor() public {\n    symbol = "PUSH";\n    name = "Push Token";\n    decimals = 2;\n    _totalSupply = 100000;\n    balances[msg.sender] = _totalSupply;\n    emit Transfer(address(0), msg.sender, _totalSupply);\n  }\n\n  function totalSupply() public constant returns (uint) {\n    return _totalSupply  - balances[address(0)];\n  }\n\n  function balanceOf(address tokenOwner) public constant returns (uint balance) {\n    return balances[tokenOwner];\n  }\n\n  function transfer(address to, uint tokens) public returns (bool success) {\n    balances[msg.sender] = safeSub(balances[msg.sender], tokens);\n    balances[to] = safeAdd(balances[to], tokens);\n    emit Transfer(msg.sender, to, tokens);\n    return true;\n  }\n\n  function approve(address spender, uint tokens) public returns (bool success) {\n    allowed[msg.sender][spender] = tokens;\n    emit Approval(msg.sender, spender, tokens);\n    return true;\n  }\n\n  function transferFrom(address from, address to, uint tokens) public returns (bool success) {\n    balances[from] = safeSub(balances[from], tokens);\n    allowed[from][msg.sender] = safeSub(allowed[from][msg.sender], tokens);\n    balances[to] = safeAdd(balances[to], tokens);\n    emit Transfer(from, to, tokens);\n    return true;\n  }\n\n  function allowance(address tokenOwner, address spender) public constant returns (uint remaining) {\n    return allowed[tokenOwner][spender];\n  }\n\n  function approveAndCall(address spender, uint tokens, bytes data) public returns (bool success) {\n    allowed[msg.sender][spender] = tokens;\n    emit Approval(msg.sender, spender, tokens);\n    ApproveAndCallFallBack(spender).receiveApproval(msg.sender, tokens, this, data);\n    return true;\n  }\n\n  function () public payable {\n    revert();\n  }\n}\n')))),(0,i.kt)("h3",{id:"subgraph-deployment"},"Subgraph deployment"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Skip this step if you already have a deployed subgraph")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Navigate to the Subgraph directory and you\u2019ll find schema.graphql file. Open in an editor of your choice and include the following Push Schema \u2014"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"type EpnsNotificationCounter @entity {\n  id: ID!\n  totalCount: BigInt!\n}\n\ntype EpnsPushNotification @entity {\n  id: ID!\n  notificationNumber: BigInt!\n  recipient: String!\n  notification: String!\n}\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In the mappings file under ",(0,i.kt)("inlineCode",{parentName:"p"},"src/")," of your subgraph, export the subgraph ID \u2014"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// Note: Push Protocol supports only The Graph Hosted Service at present\n\nexport const subgraphID = "<GITHUB_USERNAME>/<SUBGRAPH_NAME>" \n\n// example\n// export const subgraphID = "aiswaryawalter/push-graph-test"\n')),(0,i.kt)("admonition",{parentName:"li",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Make sure the above step is complete, as Subgraph ID will be imported in the next step!"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create a file named ",(0,i.kt)("inlineCode",{parentName:"p"},"PushNotification.ts")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"src/")," folder of your subgraph. We\u2019ll call this our Helper File. Now, copy the below-provided TypeScript code and paste it into the newly created Helper file \u2014"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import { BigInt,log } from \"@graphprotocol/graph-ts\"\nimport { EpnsNotificationCounter, EpnsPushNotification } from '../generated/schema'\nimport { subgraphID } from \"./push-token\"\n\nexport function sendPushNotification(recipient: string, notification: string): void \n{\n  let id1 = subgraphID\n  log.info('New id of EpnsNotificationCounter is: {}', [id1])\n  let epnsNotificationCounter = EpnsNotificationCounter.load(id1)\n  if (epnsNotificationCounter == null) {\n    epnsNotificationCounter = new EpnsNotificationCounter(id1)\n    epnsNotificationCounter.totalCount = BigInt.fromI32(0)\n  }\n  epnsNotificationCounter.totalCount = (epnsNotificationCounter.totalCount).plus(BigInt.fromI32(1))\n\n  let count = epnsNotificationCounter.totalCount.toHexString()\n  let id2 = `${subgraphID}+${count}`\n  log.info('New id of EpnsPushNotification is: {}', [id2])\n  let epnsPushNotification = EpnsPushNotification.load(id2)\n  if (epnsPushNotification == null) {\n    epnsPushNotification = new EpnsPushNotification(id2)\n  }\n  epnsPushNotification.recipient = recipient\n  epnsPushNotification.notification = notification\n  epnsPushNotification.notificationNumber = epnsNotificationCounter.totalCount\n  epnsPushNotification.save()\n  epnsNotificationCounter.save()\n}\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Import the helper function in the mappings file"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'import { sendPushNotification } from "./PushNotification"\n')),(0,i.kt)("admonition",{parentName:"li",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Follow steps 5, 6 and 7 within the respective handler functions from which the notification needs to be sent \ud83d\udc47\ud83c\udffc"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Define Notification Payload Items:")," In the event handler mapping from which you need to send the notification, define the notification payload items such as recipient of the notification, type, title, message, etc. These variables will be further used to define the notification variable."),(0,i.kt)("p",{parentName:"li"},"It\u2019s highly recommended to take a look at ",(0,i.kt)("a",{parentName:"p",href:"/docs/notifications/build/types-of-notification/",title:"Article explaining types of notifications"},"types of notifications")," to understand which one you want to send."),(0,i.kt)("p",{parentName:"li"},"For a quick reference, the ",(0,i.kt)("inlineCode",{parentName:"p"},"recipient")," differs with the payload type. For example, ",(0,i.kt)("strong",{parentName:"p"},"broadcast")," (type = 1) and special multi-payload notifications have the ",(0,i.kt)("strong",{parentName:"p"},"channel address")," as the ",(0,i.kt)("inlineCode",{parentName:"p"},"recipient"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'let recipient = event.params.to.toHexString(),\ntype = "3",\ntitle = "PUSH Received",\nbody = `Received ${event.params.tokens.div(power)} PUSH from ${event.params.from.toHexString()}`,\nsubject = "PUSH Received",\nmessage = `Received ${event.params.tokens.div(power)} PUSH from ${event.params.from.toHexString()}`,\nimage = "https://play-lh.googleusercontent.com/i911_wMmFilaAAOTLvlQJZMXoxBF34BMSzRmascHezvurtslYUgOHamxgEnMXTklsF-S",\nsecret = "null",\ncta = "https://push.org/"\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Define Notification:")," The notification variable is defined in the given below format \ud83d\udc47\ud83c\udffc "),(0,i.kt)("p",{parentName:"li"},"Format: ",(0,i.kt)("inlineCode",{parentName:"p"},'{"field1" : "value1", "field2" : "value2" }')),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'let notification = `{\\"type\\": \\"${type}\\", \\"title\\": \\"${title}\\", \\"body\\": \\"${body}\\", \\"subject\\": \\"${subject}\\", \\"message\\": \\"${message}\\", \\"image\\": \\"${image}\\", \\"secret\\": \\"${secret}\\", \\"cta\\": \\"${cta}\\"}`\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Call the Push Helper Function:")," Once the above steps are complete, we need to invoke the Push helper function and send the response. To call the Push Notification helper function, use the below script \u2014"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"sendPushNotification (recipient, notification)\n")))),(0,i.kt)("h3",{id:"redploy-your-subgraph"},"Redploy your subgraph"),(0,i.kt)("p",null,"Once you have made changes to your subgraph to include Push related logic, you now need to redploy for the subgraph network to sync the newly added logic \u2014"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Generate code"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"graph codegen\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Get the access token from the Graph dashboard & authenticate"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"graph auth --product hosted-service <ACCESS_TOKEN>\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Deploy the subgraph"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"graph deploy --product hosted-service <GITHUB_USER>/<SUBGRAPH NAME>\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Test that the logic is synced by going to the subgraph playground and pasting the below ",(0,i.kt)("strong",{parentName:"p"},"query")," to show the notification payloads"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  epnsPushNotifications(first: 20) {\n      id\n      notificationNumber\n      recipient\n      notification\n  }\n}\n")),(0,i.kt)("p",{parentName:"li"},"Here is the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ethereum-push-notification-service/push-sdk/tree/main/packages/examples/subgraph-notification",title:"Example of subgraph that has Push notifications enabled"},"final Subgraph with Push integration"),"."))),(0,i.kt)("h3",{id:"attach-subgraph-to-your-channel"},"Attach subgraph to your channel"),(0,i.kt)("p",null,"Once you have set up Push integration into your subgraph, you must add the subgraph to its notification channel in order to deliver notifications. You will require the ",(0,i.kt)("strong",{parentName:"p"},"Subgraph ID")," for this purpose."),(0,i.kt)("p",null,"It is a slug usually present at the end of the subgraph URL \ud83d\ude09, for example \u2014"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"https://thegraph.com/hosted-service/subgraph/aiswaryawalter/push-graph-test\n")),(0,i.kt)("p",null,"If you have ",(0,i.kt)("strong",{parentName:"p"},"already created your channel"),", you can follow the below steps to enable notifications from your subgraph by following these steps \u2014"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Go to ",(0,i.kt)("a",{parentName:"p",href:"https://staging.push.org",title:"Link to staging dApp of Push"},"Push staging dApp")," \u2192 Channel Dashboard \u2192 Add Subgraph Details")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Enter your ",(0,i.kt)("inlineCode",{parentName:"p"},"Subgraph ID")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Poll Interval")))),(0,i.kt)("p",null,"Poll Interval (in seconds) defines the time period at which Push Nodes shall ping the subgraph for fetching the latest notifications."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"This is an on-chain transaction that stores the above data to Push Core Contract. So it requires $ETH for gas fees.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"If you don\u2019t have a channel yet, you can easily create one by following this guide ",(0,i.kt)("a",{parentName:"p",href:"/docs/notifications/tutorials/create-your-channel/",title:"Tutorial on how to create your channel"},"here"))),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Push dApp subgraph option reference",src:n(87816).Z,title:"Illustation of how subgraph option on Push dApp looks like",width:"1650",height:"1000"})),(0,i.kt)("h3",{id:"testing-notification"},"Testing notification"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Opt-in")," to the newly created channel.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Initiate a ",(0,i.kt)("inlineCode",{parentName:"p"},"Transfer")," from your deployed contract.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Wait for the notification to appear on the recipient's wallet via Push Metamask snap, Push dApp, Push extension, Unstoppable mobile app, Push mobile app or any of the other supported interfaces. "))),(0,i.kt)("p",null,"\ud83c\udf89 Congratulations on successfully integrating Push Helper Function into your Subgraph, and also adding Subgraph details into your channel."))}f.isMDXComponent=!0},29569:function(e,t,n){t.Z=n.p+"assets/images/graphdiagram-1927c8d76718467a8ef54d64f717df72.png"},87816:function(e,t,n){t.Z=n.p+"assets/images/subgraphdetails-7a187bc0a9fb5c1a6196df5fa6ac91b3.png"}}]);